{
    "event-manager-es": {
        "messagesTimeout": 180,
        "workers": 5,
        "ackers": 5,
        "workerChildopts": "-Xmx4096m -Xms512m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:+UseCompressedOops",

        "commons": [{
            "id": "dateOperations",
            "type": "com.bbva.qnue.nema.event.validation.rules.DateOperations"
        }, {
            "id": "customerEnricherMongoConnection",
            "type": "com.bbva.qnue.nema.common.mongo.MongoConnectionManager",
            "addresses": "${mongo.connection.enrich.servers}",
            "mongoDBName": "${mongo.connection.enrich.db}",
            "username": "${mongo.connection.enrich.username}",
            "password": "${mongo.connection.enrich.password}"
        }, {
            "id": "externalRulesMongoConnection",
            "type": "com.bbva.qnue.nema.common.mongo.MongoConnectionManager",
            "addresses": "${mongo.connection.externalrules.servers}",
            "mongoDBName": "${mongo.connection.externalrules.db}",
            "username": "${mongo.connection.externalrules.username}",
            "password": "${mongo.connection.externalrules.password}"
        }, {
            "id": "n2mMongoConnection",
            "type": "com.bbva.qnue.nema.common.mongo.MongoConnectionManager",
            "addresses": "${mongo.connection.n2m.servers}",
            "mongoDBName": "${mongo.connection.n2m.db}",
            "username": "${mongo.connection.n2m.username}",
            "password": "${mongo.connection.n2m.password}"
        }],

        "enrichers": [{
            "id": "customersEnricher",
            "type": "com.bbva.qnue.nema.enrichers.mongo.CustomerMongoEnricher",
            "connection": {
                "refId": "customerEnricherMongoConnection"
            },
            "customerMongoCollection": "${mongo.connection.enrich.customersCollection}",

            "documentTypeMongoFieldName": "identityDocument.type",
            "documentMongoFieldName": "identityDocument.number",
            "cclientMongoFieldName": "_id",

            "countryIdContextFieldName": "countryCode",
            "bankCodeContextFieldName": "bankCode",
            "documentTypeContextFieldName": "documentType",
            "documentContextFieldName": "document"
        },{
            "id": "externalRuleEnricher",
            "type": "com.bbva.qnue.nema.enrichers.mongo.ExternalRulesEnricher",
            "connection": {
                "refId": "externalRulesMongoConnection"
            },
            "rulesMongoCollection": "${mongo.connection.externalrules.collection}"
        }, {
            "id": "propertyResolver",
            "type": "com.bbva.qnue.nema.enrichers.EnvPropertiesEnricher"
        }],

        "validators": [{
            "id": "n2mValidator",
            "type": "com.bbva.qnue.nema.event.validation.n2m.N2MValidationComponent",
            "connectionManager": {
                "refId": "n2mMongoConnection"
            },
            "eventsCollection": "${mongo.connection.n2m.eventsCollection}",
            "happeningsCollection": "${mongo.connection.n2m.happeningsCollection}"
        }],
        
        "spouts": [{
            "id": "CopyIncomingSpout",
            "descripton": "Read from a rabbitMQ",
            "type": "com.bbva.qnue.nema.common.spout.rabbitmq.RabbitMQSpout",

            "messagesPrefetch": 250,
            "queueName": "${qnue.incoming.queue}",
            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQConnection"
            },

            "deserializationScheme": {
                "type": "com.bbva.qnue.nema.common.spout.rabbitmq.schemes.TextWithTimestampDeserializeScheme",
                "encoding": "UTF-8",
                "declare": {
                    "mainStream": ["source", "timestamp"]
                }
            },
            
            "requeued": true,

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "ServicesIncomingSpout",
            "descripton": "Read from a rabbitMQ of services",
            "type": "com.bbva.qnue.nema.common.spout.rabbitmq.RabbitMQSpout",

            "messagesPrefetch": 250,
            "queueName": "${qnue.services.incoming.queue}",
            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQServicesConnection"
            },

            "deserializationScheme": {
                "type": "com.bbva.qnue.nema.common.spout.rabbitmq.schemes.TextWithTimestampDeserializeScheme",
                "encoding": "UTF-8",
                "declare": {
                    "mainStream": ["source", "timestamp"]
                }
            },
            
            "requeued": true,

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "IncomingRetryIncomingSpout",
            "descripton": "Read from a rabbitMQ of services",
            "type": "com.bbva.qnue.nema.common.spout.rabbitmq.RabbitMQSpout",

            "messagesPrefetch": 250,
            "queueName": "${qnue.incoming.retry.queue}",
            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQConnection"
            },

            "deserializationScheme": {
                "type": "com.bbva.qnue.nema.common.spout.rabbitmq.schemes.BsonValuesDeserializeScheme",
                "encoding": "UTF-8",
                "declare": {
                    "mainStream": ["inErrorIdComponent", "idException", "errorMessage", "inputValues"]
                }
            },
            "requeued": true,

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "DeliveryRetryIncomingSpout",
            "descripton": "Read from a rabbitMQ retry queue",
            "type": "com.bbva.qnue.nema.common.spout.rabbitmq.RabbitMQSpout",

            "messagePrefetch": 250,
            "queueName": "${qnue.retry.queue}",
            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQConnection"
            },

            "deserializationScheme": {
                "type": "com.bbva.qnue.nema.common.spout.rabbitmq.schemes.BsonValuesDeserializeScheme",
                "declare": {
                    "mainStream": ["inErrorIdComponent", "idException", "errorMessage", "inputValues"]
                }
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "MultiEventsIncomingSpout",
            "descripton": "Read from a rabbitMQ retry queue",
            "type": "com.bbva.qnue.nema.common.spout.rabbitmq.RabbitMQSpout",

            "messagePrefetch": 250,
            "queueName": "${qnue.multi.events.queue}",
            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQConnection"
            },

            "deserializationScheme": {
                "type": "com.bbva.qnue.nema.common.spout.rabbitmq.schemes.BsonValuesDeserializeScheme",
                "declare": {
                    "mainStream": ["eventType", "eventRenderType", "eventRenderedModel", "monitoringInfo"]
                }
            },
            
            "requeued": true,

            "executorsNumber": 4,
            "tasksNumber": 4
        },{
            "id": "rabbitmqN2MEvents",
            "type": "com.bbva.qnue.nema.history.transfer.spout.RabbitMQMongoTransferSpout",

            "messagesPrefetch": 100,
            "queueName": "${qnue.n2m.queue:qnue-n2m}",

            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQConnection"
            },

            "bulkSize": 50,
            "maxWaitingForNexBulk": 2000,

            "mongoConnection": {
                "refId": "n2mMongoConnection"
            },

            "mongoCollectionName": "${mongo.n2m.collection:C_QNUE_N2M}",
            "documentId": "_id",

            "executorsNumber": 3,
            "tasksNumber": 3
        }],

        "bolts": [{
            "id": "01.Identification",
            "description": "Identifies happenings",
            "type": "com.bbva.qnue.nema.source.identification.bolt.HappeningIdentificationBolt",

            "declare": {
                "mainStream": ["timestamp", "happeningId", "happeningFrame", "happeningType"]
            },

            "errorStream": "errorStream",

            "chainedTo": [{
                "stream": "mainStream",
                "id": "CopyIncomingSpout"
            }, {
                "stream": "mainStream",
                "id": "ServicesIncomingSpout"
            }],

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "02.Parser",
            "type": "com.bbva.qnue.nema.source.parsing.bolt.HappeningParserBolt",
            "declare": {
                "mainStream": ["happeningId", "happeningType", "monitoringInfo"],
                "history": ["happeningId", "happeningType", "monitoringInfo"]
            },
            "stream": "mainStream",
            "errorStream": "errorStream",
            "historyStream": "history",

            "chainedTo": {
                "id": "01.Identification",
                "stream": "mainStream"
            },

            "executorsNumber": 8,
            "tasksNumber": 8
        },{
            "id": "02.1.Filter",
            "description": "filters happenings",
            "type": "com.bbva.qnue.nema.common.bolt.filter.FilterByAmountsBolt",

            "declare": {
                "mainStream": ["happeningId", "happeningType", "monitoringInfo"],
                "notificationStream": ["happeningId", "happeningType", "monitoringInfo"],
                "historyStream": ["monitoringInfo"]
            },

            "notifyStream": "notificationStream",
            "historyStream": "historyStream",
            "groupByField": "#{T(com.bbva.qnue.nema.monitorization.HappeningMonitorization).TYPE}",
            "elasticConnectionManager": {
            	"type": "com.bbva.qnue.nema.common.elastic.manager.ElasticConnectionManager",
            	"host":"${env.conf.elastic.host}",
            	"port":"${env.conf.elastic.port}",
            	"collection":"${env.conf.elastic.collection.happenings}"
            },

            "chainedTo": {
                "id": "02.Parser",
                "stream": "mainStream"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "01.RetryRouterHandler",
            "type": "com.bbva.qnue.nema.event.retry.EventRetryRouterBolt",

            "monitorizationFieldName": "monitoringInfo",
            "historyStream" : "historyStream",

            "declare": {
                "03.BuilderIdentification": ["happeningId", "happeningType", "monitoringInfo"],
                "03.Builder": ["happeningTypeId", "happeningModel", "eventsList", "monitoringInfo"],
                "04.Validation": ["eventsMap", "monitoringInfo"],
                "07.Dispatcher" : ["eventType", "renderType","renderedModel", "monitoringInfo"],
                "errorStream": ["inErrorIdComponent", "idException", "errorMessage", "inputValues"],
                "historyStream": ["destination", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "retryNumber": "${env.conf.retry.retryNumber}",

            "chainedTo": [{
                "id": "IncomingRetryIncomingSpout",
                "stream": "mainStream"
            },{
            	"id": "DeliveryRetryIncomingSpout",
                "stream": "mainStream"
            }],

            "executorsNumber": 8,
            "tasksNumber": 8
        }, {
            "id": "03.HappeningHistoryRouter",
            "type": "com.bbva.qnue.nema.common.bolt.history.router.HappeningHistoryRouter",

            "declare": {
                "history": ["monitoringInfo"],
                "n2mStream": ["happeningId", "happeningType"]
            },

            "historyStream": "history",
            "n2mStream": "n2mStream",

            "chainedTo": {
                "id": "02.Parser",
                "stream": "history"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "03.RetryFailedHistory",
            "type": "com.bbva.qnue.nema.event.retry.HistoryRetryFailedBolt",

            "declare": {
                "eventHistory": ["monitoringInfo"],
                "happeningHistory": ["monitoringInfo"]
            },

            "eventsHistoryStream": "eventHistory",
            "happeningsHistoryStream": "happeningHistory",
            
            "eventsRetryDestination": {
            	"08.CRMLoginEventDelivery": "08.CRMLoginEventDelivery",
                "08.CRMShoppingEventDelivery": "08.CRMShoppingEventDelivery",
                "08.OtherEventsDelivery": "08.OtherEventsDelivery",
                "08.KXDAMQEventsDelivery": "08.KXDAMQEventsDelivery",
                "08.GUCMQEventsDelivery": "08.GUCMQEventsDelivery",
                "08.APX200MQEventsDelivery": "08.APX200MQEventsDelivery",
                "08.APX400MQEventsDelivery": "08.APX400MQEventsDelivery",
                "08.CRMMQParaleloEventsDelivery": "08.CRMMQParaleloEventsDelivery",
                "08.CRMMQProductivoEventsDelivery": "08.CRMMQProductivoEventsDelivery",
                "08.CRMBatchEventsDelivery": "08.CRMBatchEventsDelivery",
                "08.ESBParaleloEventsDelivery": "08.ESBParaleloEventsDelivery",
            	"08.EKSAOpenPlatformDelivery": "08.EKSAOpenPlatformDelivery",
            	"08.FDSDelivery": "08.FDSDelivery",
            	"07.Dispatcher": "07.Dispatcher"
            },

            "chainedTo": {
                "id": "01.RetryRouterHandler",
                "stream": "historyStream"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        },{
            "id": "03.BuilderIdentification",
            "type": "com.bbva.qnue.nema.event.builder.bolt.EventBuilderIdentificationBolt",

            "chainedTo": [{
                "id": "02.1.Filter",
                "stream": "mainStream"
            }, {
                "id": "01.RetryRouterHandler",
                "stream": "03.BuilderIdentification"
            }],
            "stream": "mainStream",
            "errorStream": "errorStream",

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "03.Builder",
            "description": "Event builder bolt",
            "type": "com.bbva.qnue.nema.event.builder.bolt.EventBuilderBolt",

            "declare": {
                "mainStream": ["eventsMap", "monitoringInfo"]
            },

            "exceptionList": ["com.mongodb.MongoException"],

            "errorStream": "errorStream",
            "retryStream": "retryStream",

            "chainedTo": [{
                "id": "03.BuilderIdentification",
                "stream": "mainStream"
            }, {
                "id": "01.RetryRouterHandler",
                "stream": "03.Builder"
            }],
            "executorsNumber": 24,
            "tasksNumber": 24
        }, {
            "id": "03.HappeningHistory",
            "type": "com.bbva.qnue.nema.common.bolt.RabbitMQBolt",

            "exchange": "${qnue.exchange.monitoring.happenings}",
            "routingKey": "${qnue.monitoring.happenings.routingkey}",

            "errorStream": "errorStream",
            "stream": "noStream",

            "serializer": {
                "type": "com.bbva.qnue.nema.history.rabbitmq.serializer.StormJsonFlatTupleSerializer",
                "field" : "monitoringInfo"
            },

            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "monitoringConnection"
            },

            "chainedTo": [{
                "id": "03.HappeningHistoryRouter",
                "stream": "history"
            },
            {
                "id": "03.RetryFailedHistory",
                 "stream": "happeningHistory"
            },
            {
            	"id": "02.1.Filter",
            	"stream": "historyStream"
            }],

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {  
            "id": "03.HappeningN2MStore",
            "type": "com.bbva.qnue.nema.common.bolt.RabbitMQBolt",

            "exchange": "${qnue.exchange.default}",
            "routingKey": "${qnue.n2m.happenings.routingKey}",

            "errorStream": "errorStream",
            "stream": "noStream",

            "serializer": {
                "type": "com.bbva.qnue.nema.common.bolt.rabbitmq.serializer.N2MSerializer",
                "field": "happeningType"
            },

            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQConnection"
            },

            "chainedTo": {
                "id": "03.HappeningHistoryRouter",
                "stream": "n2mStream"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "04.Validation",
            "type": "com.bbva.qnue.nema.event.validation.bolt.EventValidationBolt",
            "declare": {
                "mainStream": ["eventsMap", "monitoringInfo"]
            },

            "exceptionList": ["com.mongodb.MongoException"],

            "errorStream": "errorStream",
            "retryStream": "retryStream",

            "chainedTo": [{
                "id": "03.Builder",
                "stream": "mainStream"
            }, {
                "id": "01.RetryRouterHandler",
                "stream": "04.Validation"
            }],

            "executorsNumber": 8,
            "tasksNumber": 8
        }, {
            "id": "05.Render",
            "type": "com.bbva.qnue.nema.event.render.bolt.EventRendererBolt",
            "declare": {
                "mainStream": ["eventsRenderMap", "monitoringInfo"]
            },

            "errorStream": "errorStream",

            "chainedTo": [{
                "id": "04.Validation",
                "stream": "mainStream"
            }],
            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "06.Router",
            "type": "com.bbva.qnue.nema.event.router.bolt.EventRouterBolt",
            "declare": {
                "multipleEvents": ["eventsRenderMap", "monitoringInfo"],
                "oneEvent": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "singleEventStream": "oneEvent",
            "multipleEventStream": "multipleEvents",
            "errorStream": "errorStream",

            "chainedTo": {
                "id": "05.Render",
                "stream": "mainStream"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "07.MultipleEventsDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.rabbitmq.MultiDeliveryRabbitMQBolt",
            "chainedTo": {
                "id": "06.Router",
                "stream": "multipleEvents"
            },

            "exchange": "${qnue.exchange.default}",
            "routingKey": "${qnue.multi.events.delivery.routingKey}",

            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQConnection"
            },

            "serializer": {
                "type": "com.bbva.qnue.nema.common.bolt.rabbitmq.serializer.BsonRawTupleSerializer"
            },

            "multiMessageSplitter": {
                "type": "com.bbva.qnue.nema.common.bolt.rabbitmq.serializer.utils.MultiEventsTupleSplitterUtil"
            },
            "txEnabled": "true",

            "executorsNumber": 64,
            "tasksNumber": 64
        },{
            "id": "06.1.FilterEvent",
            "description": "Filters Events",
            "type": "com.bbva.qnue.nema.common.bolt.filter.FilterByAmountsBolt",

            "declare": {
                "mainStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "notificationStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "historyStream": ["monitoringInfo"]
            },

            "notifyStream": "notificationStream",
            "historyStream": "historyStream",
            "groupByField": "#{T(com.bbva.qnue.nema.monitorization.EventMonitorization).TYPE}",
            "elasticConnectionManager": {
            	"type": "com.bbva.qnue.nema.common.elastic.manager.ElasticConnectionManager",
            	"host":"${env.conf.elastic.host}",
            	"port":"${env.conf.elastic.port}",
            	"collection":"${env.conf.elastic.collection.events}"
            },

            "chainedTo": [{
                "id": "06.Router",
                "stream": "oneEvent"
            }, {
            	"id" :"MultiEventsIncomingSpout",
            	"stream" : "mainStream"
            }],

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "07.Dispatcher",
            "type": "com.bbva.qnue.nema.event.dispatch.bolt.EventDispatcherDeliveryBolt",

            "chainedTo": [{
                "id": "06.1.FilterEvent",
                "stream": "mainStream"
            }, {
            	"id": "01.RetryRouterHandler",
            	"stream": "07.Dispatcher"
            }],
            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "10.ErrorDeliveryBolt",

            "type": "com.bbva.qnue.nema.common.bolt.RabbitMQBolt",
            "exchange": "${qnue.exchange.default}",
            "routingKey": "${qnue.error.routingKey}",

            "errorStream": "errorStream",
            "stream": "noStream",

            "serializer": {
                "type": "com.bbva.qnue.nema.common.bolt.rabbitmq.serializer.BsonRawTupleSerializer"
            },

            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQConnection"
            },

            "chainedTo": [{
                "id": "01.Identification",
                "stream": "errorStream"
            }, {
                "id": "02.Parser",
                "stream": "errorStream"
            }, {
                "id": "03.BuilderIdentification",
                "stream": "errorStream"
            }, {
                "id": "03.Builder",
                "stream": "errorStream"

            }, {
                "id": "04.Validation",
                "stream": "errorStream"
            }, {
                "id": "05.Render",
                "stream": "errorStream"
            }, {
                "id": "06.Router",
                "stream": "errorStream"
            }, {
                "id": "07.Dispatcher",
                "stream": "errorStream"

            }, {
                "id": "01.RetryRouterHandler",
                "stream": "errorStream"
            }],

            "executorsNumber": 8,
            "tasksNumber": 8
        }, {
            "id": "10.IncomingRetryOutgoingBolt",
            "type": "com.bbva.qnue.nema.common.bolt.RabbitMQBolt",

            "exchange": "${qnue.exchange.default}",
            "routingKey": "${qnue.incoming.retry.outgoing.routingKey}",

            "errorStream": "errorStream",
            "stream": "noStream",

            "serializer": {
                "type": "com.bbva.qnue.nema.common.bolt.rabbitmq.serializer.BsonRawTupleSerializer"
            },

            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQConnection"
            },

            "chainedTo": [{
                "id": "03.Builder",
                "stream": "retryStream"
            }, {
                "id": "04.Validation",
                "stream": "retryStream"
            }],

            "executorsNumber": 8,
            "tasksNumber": 8
        }, {
            "id": "08.CRMShoppingEventDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.RabbitMQBolt",

                "exchange": "${qnue.crm.exchange}",
                "routingKey": "${qnue.crm.shoppings.routingKey}",

                "serializer": {
                    "type": "com.bbva.qnue.nema.common.bolt.TextTupleSerializer",
                    "tupleField": "#{T(com.bbva.qnue.nema.event.dispatch.bolt.EventDispatcherDeliveryBolt).EVENT_RENDERED_MODEL_FIELD_NAME}"
                },

                "connectionManager": {
                    "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                    "source": "rabbitMQCRMConnection"
                }

            },

            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQCRMConnection"
            },

            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "crmShoppingEventQueue"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {

            "id": "08.CRMLoginEventDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.RabbitMQBolt",

                "exchange": "${qnue.crm.exchange}",
                "routingKey": "${qnue.crm.login.routingKey}",

                "serializer": {
                    "type": "com.bbva.qnue.nema.common.bolt.TextTupleSerializer",
                    "tupleField": "#{T(com.bbva.qnue.nema.event.dispatch.bolt.EventDispatcherDeliveryBolt).EVENT_RENDERED_MODEL_FIELD_NAME}"
                },

                "connectionManager": {
                    "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                    "source": "rabbitMQCRMConnection"
                }
            },

            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "crmLoginEventQueue"
            },

            "executorsNumber": 4,
            "tasksNumber": 4

        }, {
            "id": "08.OtherEventsDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.RabbitMQBolt",

                "exchange": "${qnue.exchange.default}",
                "routingKey": "${qnue.routingKey.default}",

                "serializer": {
                    "type": "com.bbva.qnue.nema.common.bolt.TextTupleSerializer",
                    "tupleField": "#{T(com.bbva.qnue.nema.event.dispatch.bolt.EventDispatcherDeliveryBolt).EVENT_RENDERED_MODEL_FIELD_NAME}"
                },

                "connectionManager": {
                    "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                    "source": "rabbitMQCRMConnection"
                }
            },

            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "defaultDelivery"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "08.EKSAOpenPlatformDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.RabbitMQBolt",

                "exchange": "${qnue.openplatform.exchange}",
                "routingKey": "${qnue.openplatform.routingKey}",

                "serializer": {
                    "type": "com.bbva.qnue.nema.common.bolt.TextTupleSerializer",
                    "tupleField": "#{T(com.bbva.qnue.nema.event.dispatch.bolt.EventDispatcherDeliveryBolt).EVENT_RENDERED_MODEL_FIELD_NAME}"
                },

                "connectionManager": {
                    "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                    "source": "rabbitMQCRMConnection"
                }
            },

            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "openPlatformDelivery"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "08.CRMMQParaleloEventsDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",


            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.jms.ConfigurableJMSBolt",

                "jmsProvider": {
                    "type": "com.bbva.qnue.nema.common.spout.jms.provider.MQSeriesJmsProvider",
                    "source": "crmOnlineMQ"
                },

                "producer": {
                    "type": "com.bbva.qnue.nema.common.bolt.jms.producer.ConfigurableTextJMSMessageProducer",
                    "defaultPriority": 5
                },
                "disablePublish": "${env.conf.delivery.crm.online.paralelo.disable:true}"
            },

            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "crmOnlineParaleloStream"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "08.CRMMQProductivoEventsDelivery",

            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.jms.ConfigurableJMSBolt",

                "jmsProvider": {
                    "type": "com.bbva.qnue.nema.common.spout.jms.provider.MQSeriesJmsProvider",
                    "source": "crmOnlineMQ"
                },

                "producer": {
                    "type": "com.bbva.qnue.nema.common.bolt.jms.producer.ConfigurableTextJMSMessageProducer",
                    "defaultPriority": 5
                }
            },



            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "crmOnlineProductivoStream"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {

            "id": "08.KXDAMQEventsDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",


            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.jms.ConfigurableJMSBolt",
                "jmsProvider": {
                    "type": "com.bbva.qnue.nema.common.spout.jms.provider.MQSeriesJmsProvider",
                    "source": "KXDAMQ"
                },

                "producer": {
                    "type": "com.bbva.qnue.nema.common.bolt.jms.producer.ConfigurableTextJMSMessageProducer"
                }
            },

            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "KXDAMQ"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "08.GUCMQEventsDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.jms.ConfigurableJMSBolt",
                "jmsProvider": {
                    "type": "com.bbva.qnue.nema.common.spout.jms.provider.MQSeriesJmsProvider",
                    "source": "gucOnlineMQ"
                },
                "producer": {
                    "type": "com.bbva.qnue.nema.common.bolt.jms.producer.ConfigurableTextJMSMessageProducer"
                }
            },


            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "gucOnlineMQ"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "08.APX200MQEventsDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

			"delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.jms.ConfigurableJMSBolt",
                "jmsProvider": {
                    "type": "com.bbva.qnue.nema.common.spout.jms.provider.RabbitMQSeriesJmsProvider",
                    "source": "apxOnlineRabbitMQ"
                },
                "producer": {
                    "type": "com.bbva.qnue.nema.common.bolt.jms.producer.ConfigurableTextJMSMessageProducer",
                    "defaultPriority": 4
                },
                "disablePublish": "${env.conf.delivery.crm.batch.paralelo.disable:true}"
            },

            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "apx200-Stream"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "08.APX400MQEventsDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.jms.ConfigurableJMSBolt",
                "jmsProvider": {
                    "type": "com.bbva.qnue.nema.common.spout.jms.provider.RabbitMQSeriesJmsProvider",
                    "source": "apxOnlineRabbitMQ"
                },
                "producer": {
                    "type": "com.bbva.qnue.nema.common.bolt.jms.producer.ConfigurableTextJMSMessageProducer",
                    "defaultPriority": 1
                },
                "disablePublish": "${env.conf.delivery.crm.batch.paralelo.disable:true}"
            },


            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "apx400-Stream"
            },

            "executorsNumber": 64,
            "tasksNumber": 64
        }, {
            "id": "08.CRMBatchEventsDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.jms.ConfigurableJMSBolt",
                "jmsProvider": {
                    "type": "com.bbva.qnue.nema.common.spout.jms.provider.MQSeriesJmsProvider",
                    "source": "crmBatchMQ"
                },
                "producer": {
                    "type": "com.bbva.qnue.nema.common.bolt.jms.producer.ConfigurableTextJMSMessageProducer",
                    "defaultPriority": 5
                },
                "disablePublish": "${env.conf.delivery.crm.batch.paralelo.disable:true}"
            },
            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "crmBatchStream"
            },

            "executorsNumber": 64,
            "tasksNumber": 64
        }, {
            "id": "08.ESBParaleloEventsDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.common.bolt.jms.ConfigurableJMSBolt",
                "jmsProvider": {
                    "type": "com.bbva.qnue.nema.common.spout.jms.provider.MQSeriesJmsProvider",
                    "source": "esbOnlineMQ"
                },
                "producer": {
                    "type": "com.bbva.qnue.nema.common.bolt.jms.producer.ConfigurableTextJMSMessageProducer",
                    "defaultPriority": 5
                },
                "disablePublish": "${env.conf.delivery.esb.paralelo.disable:true}"
            },


            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "esbStream"
            },


            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "08.FDSDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
                "historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },

            "errorStream": "errorStream",
            "historyStream": "historyStream",

            "delivery": {
                "type": "com.bbva.qnue.nema.event.asyncHttp.bolt.AsyncHttpBolt",
                "headerConfig" : {
                	"Accept-Encoding": "gzip,deflate",
                	"Content-Type" : "text/xml;charset=UTF-8"
                },
                "url" : "${env.http.asyncconnection.granting.url}"
            },

            "chainedTo": {
                "id": "07.Dispatcher",
                "stream": "grantingTicketStream"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "09.EventsN2MStore",
            "type": "com.bbva.qnue.nema.common.bolt.delivery.DeliveryHandlerBolt",

            "declare": {
            	"historyStream": ["eventType", "eventRender", "model", "monitoringInfo"],
                "errorStream": ["eventType", "eventRender", "model", "monitoringInfo"]
            },
            
            "chainedTo": { 
            	"id": "07.Dispatcher",
            	"stream" : "n2mStream"
            },

            "errorStream": "errorStream",
            "historyStream" : "historyStream",

            "delivery": {
	            "type": "com.bbva.qnue.nema.common.bolt.RabbitMQBolt",
    

            	"exchange": "${qnue.exchange.default}",
            	"routingKey": "${qnue.n2m.events.routingKey}",

	            "serializer": {
	                "type": "com.bbva.qnue.nema.common.bolt.rabbitmq.serializer.N2MSerializer",
	                "field": "#{T(com.bbva.qnue.nema.event.dispatch.bolt.EventDispatcherDeliveryBolt).EVENT_RENDERED_MODEL_FIELD_NAME}"
	            },

	            "connectionManager": {
	                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
	                "source": "rabbitMQConnection"
	            }
	         },
	         
            "executorsNumber": 4,
            "tasksNumber": 4
        },  {
            "id": "09.EventHistoryRouter",
            "type": "com.bbva.qnue.nema.common.bolt.history.router.EventHistoryRouter",

            "declare": {
                "historyStream": ["monitoringInfo"]
            },

            "historyStream": "historyStream",

            "chainedTo": [{
                "id": "08.CRMLoginEventDelivery",
                "stream": "historyStream"
            }, {
                "id": "08.CRMShoppingEventDelivery",
                "stream": "historyStream"
            }, {
                "id": "08.OtherEventsDelivery",
                "stream": "historyStream"
            }, {
                "id": "08.KXDAMQEventsDelivery",
                "stream": "historyStream"
            }, {
                "id": "08.GUCMQEventsDelivery",
                "stream": "historyStream"
            }, {
                "id": "08.APX200MQEventsDelivery",
                "stream": "historyStream"
            }, {
                "id": "08.APX400MQEventsDelivery",
                "stream": "historyStream"
            }, {
                "id": "08.CRMMQParaleloEventsDelivery",
                "stream": "historyStream"
            }, {
                "id": "08.CRMMQProductivoEventsDelivery",
                "stream": "historyStream"
            }, {
                "id": "08.CRMBatchEventsDelivery",
                "stream": "historyStream"
            }, {
                "id": "08.ESBParaleloEventsDelivery",
                "stream": "historyStream"
            }, {
            	"id": "08.EKSAOpenPlatformDelivery",
                "stream": "historyStream"
            }, { 
            	"id": "09.EventsN2MStore",
            	"stream" : "historyStream"
            }, { 
            	"id": "08.FDSDelivery",
            	"stream" : "historyStream"
            }],
            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "09.EventsHistory",
            "type": "com.bbva.qnue.nema.common.bolt.RabbitMQBolt",
            "chainedTo": [{
                "id": "09.EventHistoryRouter",
                "stream": "historyStream"
            },
            {
                "id": "03.RetryFailedHistory",
                 "stream": "eventHistory"
            },
            {
                "id": "06.1.FilterEvent",
                 "stream": "historyStream"
            }
            ],

            "declare": {
                "noStream": ["monitoringInfo"]
            },

            "errorStream": "noStream",

            "exchange": "${qnue.exchange.monitoring.events}",
            "routingKey": "${qnue.monitoring.events.routingkey}",

            "serializer": {
                "type": "com.bbva.qnue.nema.history.rabbitmq.serializer.StormJsonFlatTupleSerializer",
                "field": "monitoringInfo"
            },

            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "monitoringConnection"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }, {
            "id": "09.1-RetryDelivery",
            "type": "com.bbva.qnue.nema.common.bolt.RabbitMQBolt",
            "chainedTo": [{
                "id": "08.CRMLoginEventDelivery",
                "stream": "errorStream"
            }, {
                "id": "08.CRMShoppingEventDelivery",
                "stream": "errorStream"
            }, {
                "id": "08.OtherEventsDelivery",
                "stream": "errorStream"
            }, {
                "id": "08.KXDAMQEventsDelivery",
                "stream": "errorStream"
            }, {
                "id": "08.GUCMQEventsDelivery",
                "stream": "errorStream"
            }, {
                "id": "08.APX200MQEventsDelivery",
                "stream": "errorStream"
            }, {
                "id": "08.APX400MQEventsDelivery",
                "stream": "errorStream"
            }, {
                "id": "08.CRMMQParaleloEventsDelivery",
                "stream": "errorStream"
            }, {
                "id": "08.CRMMQProductivoEventsDelivery",
                "stream": "errorStream"
            }, {
                "id": "08.CRMBatchEventsDelivery",
                "stream": "errorStream"
            }, {
                "id": "08.ESBParaleloEventsDelivery",
                "stream": "errorStream"
            }, {
            	"id": "08.EKSAOpenPlatformDelivery",
                "stream": "errorStream"
            }, { 
            	"id": "09.EventsN2MStore",
            	"stream" : "errorStream"
            }],

            "exchange": "${qnue.exchange.default}",
            "routingKey": "${qnue.retry.outgoin.routingKey}",

            "serializer": {
                "type": "com.bbva.qnue.nema.common.bolt.rabbitmq.serializer.BsonRawTupleSerializer"
            },

            "connectionManager": {
                "type": "com.bbva.qnue.nema.common.rabbitmq.manager.RabbitMQConnectionManager",
                "source": "rabbitMQConnection"
            },

            "executorsNumber": 4,
            "tasksNumber": 4
        }]
    }
}
